{
  "hash": "88c0a5c16635d7ff1a2b79ec7d9afce9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take Home Exercise 3\"\nauthor: \"Rydia\"\ndate: \"May 13, 2024\"\ndate-modified: \"last-modified\"\nexecute:\n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n---\n\n\n# VAST 2024 Mini Challenge 2\n\n## Mini-Challenge 2: Creating Signatures for Geo-Temporal Patterns\n\nMini-challenge 2 focuses on analyzing ship movements and shipping records to understand illegal fishing practices. FishEye analysts need help creating visualizations to show patterns of ship movements and identify suspicious behaviors. They also want to understand how the commercial fishing community changed after a company was caught fishing illegally.\n\nThe details of the mini challenge can be found [here](https://vast-challenge.github.io/2024/MC2.html).\n\n## Tasks and Questions\n\nFishEye analysts need your help to perform geographic and temporal analysis of the CatchNet data so they can prevent illegal fishing from happening again. Your task is to develop new visual analytics tools and workflows that can be used to discover and understand signatures of different types of behavior. Can you use your tool to visualize a signature of SouthSeafood Express Corp’s illegal behavior? FishEye needs your help to develop a workflow to find other instances of illegal behavior.\n\n1.  FishEye analysts have long wanted to better understand the flow of commercially caught fish through Oceanus’s many ports. But as they were loading data into CatchNet, they discovered they had purchased the wrong port records. They wanted to get the ship off-load records, but they instead got the port-exit records (essentially trucks/trains leaving the port area). Port exit records do not include which vessel that delivered the products. Given this limitation, develop a visualization system to associate vessels with their probable cargos. Which vessels deliver which products and when? What are the seasonal trends and anomalies in the port exit records?\n\n2.  Develop visualizations that illustrate the inappropriate behavior of SouthSeafood Express Corp vessels. How do their movement and catch contents compare to other fishing vessels? When and where did SouthSeafood Express Corp vessels perform their illegal fishing? How many different types of suspicious behaviors are observed? Use visual evidence to justify your conclusions.\n\n3.  To support further Fisheye investigations, develop visual analytics workflows that allow you to discover other vessels engaging in behaviors similar to SouthSeafood Express Corp’s illegal activities? Provide visual evidence of the similarities.\n\n4.  How did fishing activity change after SouthSeafood Express Corp was caught? What new behaviors in the Oceanus commercial fishing community are most suspicious and why?\n\n## 1.0 Data Preparation\n\n## 1.1 Loading R Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, jsonlite, DT, lubridate,\n               igraph, tidygraph, ggraph, \n               visNetwork, sf)\n```\n:::\n\n\n## 1.2 Loading the Data\n\nLoading the .json data using `jsonlite` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc2_data <- fromJSON(\"data/MC2/mc2.json\")\n```\n:::\n\n\nmc2 is a directed multigraph, consists of nodes dataframe and links dataframe.\n\n\n::: {.cell}\n\n```{.r .cell-code}\noceanus_map <- read_sf(\"data/MC2/Oceanus Information/Oceanus Geography.geojson\")\n```\n:::\n\n\nLoading the oceanus map:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(oceanus_map) +\n  geom_sf(color = \"black\",\n          ) +\n  theme_void() +\n  geom_sf_text(aes(label = Name), size = 2,\n               vjust = 1.5)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n## 1.3 Extracting the tibbles for nodes and links\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc2_nodes_raw <- as_tibble(mc2_data$nodes)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmc2_edges_raw <- as_tibble(mc2_data$links)\n```\n:::\n\n\n## 1.4 Checking for missing values in data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolSums(is.na(mc2_nodes_raw))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                type      _last_edited_by          _date_added \n                   0                    0                    0 \n   _last_edited_date          _raw_source           _algorithm \n                   0                    0                    0 \n                name                   id                 Name \n                5627                    0                 5317 \n         Description           Activities                 kind \n                5623                    0                 5613 \n            qty_tons                 date         flag_country \n                 330                  330                 5341 \n             company              tonnage       length_overall \n                5458                 5359                 5354 \n               style fish_species_present \n                5635                    0 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncolSums(is.na(mc2_edges_raw))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             type              time             dwell   _last_edited_by \n                0             13101             13101                 0 \n      _date_added _last_edited_date       _raw_source        _algorithm \n                0                 0                 0                 0 \n           source            target               key              date \n                0                 0                 0            258542 \n      data_author          aphorism  holiday_greeting            wisdom \n           269156            269669            270639            269719 \nsaying of the sea \n           269750 \n```\n\n\n:::\n:::\n\n\n## 1.5 Parsing the time with lubridate\n\nAs the `_date_added` and `_last_edited_date` contains a mixture of format, we first extract the date in \"yyyy-mm-dd\" format using `substr`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc2_nodes_raw <- mc2_nodes_raw |> \n  mutate(`_date_added` = substr(`_date_added`,1,10)) |> \n  mutate(`_date_added` = ymd(`_date_added`)) |> \n  mutate(`_last_edited_date` = substr(`_last_edited_date`,1,10)) |> \n  mutate(`_last_edited_date` = ymd(`_last_edited_date`)) |> \n  mutate(date = ymd(date))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmc2_edges_raw <- mc2_edges_raw %>% \n  mutate(`_date_added` = substr(`_date_added`,1,10)) %>% \n  mutate(`_date_added` = ymd(`_date_added`)) %>% \n  mutate(`_last_edited_date`= substr(`_last_edited_date`,1,10)) %>% \n  mutate(`_last_edited_date` = ymd(`_last_edited_date`)) %>% \n  mutate(time = ymd_hms(time))\n```\n:::\n\n\n**Understanding the Data**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique_nodes_type <- mc2_nodes_raw |>  distinct(type)\nunique_nodes_type\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 12 × 1\n   type                          \n   <chr>                         \n 1 Entity.Commodity.Fish         \n 2 Entity.Location.City          \n 3 Entity.Document.DeliveryReport\n 4 Entity.Vessel.FishingVessel   \n 5 Entity.Vessel.Other           \n 6 Entity.Vessel.Ferry.Passenger \n 7 Entity.Vessel.CargoVessel     \n 8 Entity.Vessel.Ferry.Cargo     \n 9 Entity.Vessel.Research        \n10 Entity.Vessel.Tour            \n11 Entity.Location.Point         \n12 Entity.Location.Region        \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nunique_edges_type <- mc2_edges_raw |>  distinct(type)\nunique_edges_type\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 1\n  type                                \n  <chr>                               \n1 Event.TransportEvent.TransponderPing\n2 Event.Transaction                   \n3 Event.HarborReport                  \n```\n\n\n:::\n:::\n\n\n## 1.6 Aggregating weight for edges\nTo get aggregated weight for the edges by unique source, target and type.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc2_edges_agg <-\n  mc2_edges_raw %>%\n  distinct() %>%\n  mutate(source = as.character(source),\n         target = as.character(target),\n         type = as.character(type)) %>%\n  group_by(source, target, type) %>%\n  summarise(weights = n()) %>%\n  filter(source!=target) \n  ungroup\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nfunction (x, ...) \n{\n    UseMethod(\"ungroup\")\n}\n<bytecode: 0x0000018ed20c9038>\n<environment: namespace:dplyr>\n```\n\n\n:::\n:::\n\n\n\n## 2.0 Task 1\n\n## 2.1 Flow of fishing vessels\n\nFishEye analysts have long wanted to better understand the flow of commercially caught fish through Oceanus’s many ports.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntransaction_edges <- mc2_edges_raw %>% \n  filter(type == \"Event.Transaction\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntransaction_edges_agg <-\n  transaction_edges  %>%\n  distinct() %>%\n  group_by(source, target, type) %>%\n  summarise(weights = n()) %>%\n  filter(source!=target) %>% \n  ungroup\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfishing_vessels_nodes <- mc2_nodes_raw %>% \n  filter(type == \"Entity.Vessel.FishingVessel\")\nfishing_vessels_nodes \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 178 × 20\n   type        `_last_edited_by` `_date_added` `_last_edited_date` `_raw_source`\n   <chr>       <chr>             <date>        <date>              <chr>        \n 1 Entity.Ves… Olokun Daramola   2034-05-18    2034-09-20          Oceanus Vess…\n 2 Entity.Ves… Harvey Janus      2034-01-03    2034-05-19          Oceanus Vess…\n 3 Entity.Ves… Harvey Janus      2034-12-22    2035-03-29          Oceanus Vess…\n 4 Entity.Ves… Harvey Janus      2034-03-11    2034-07-23          Oceanus Vess…\n 5 Entity.Ves… Junior Shurdlu    2034-08-15    2034-11-01          Oceanus Vess…\n 6 Entity.Ves… Junior Shurdlu    2033-10-14    2034-02-28          Oceanus Vess…\n 7 Entity.Ves… Harvey Janus      2033-06-14    2033-09-10          Oceanus Vess…\n 8 Entity.Ves… Harvey Janus      2033-11-15    2034-01-16          Oceanus Vess…\n 9 Entity.Ves… Jack Inch         2033-08-01    2033-08-16          Oceanus Vess…\n10 Entity.Ves… Jack Inch         2034-04-09    2034-06-11          Oceanus Vess…\n# ℹ 168 more rows\n# ℹ 15 more variables: `_algorithm` <chr>, name <chr>, id <chr>, Name <chr>,\n#   Description <chr>, Activities <list>, kind <chr>, qty_tons <dbl>,\n#   date <date>, flag_country <chr>, company <chr>, tonnage <int>,\n#   length_overall <int>, style <chr>, fish_species_present <list>\n```\n\n\n:::\n:::\n\n\nThere is a total of 178 Fishing vessels in Oceanus.\n\n## 2.2 Fishing ground locations\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfishing_ground <- mc2_nodes_raw %>% \n  filter(kind == \"Fishing Ground\") \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnon_fishing_ground <- mc2_nodes_raw %>%  \n  filter(kind == \"Ecological Preserve\") \n```\n:::\n\n\nThere are three fishing grounds:\n\n1\\. Cod Table\n\n2\\. Wrasse Beds\n\n3\\. Tuna Shelf\n\nFishing outside these fishing grounds are considered illegal fishing.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncargo_vessels <- mc2_nodes_raw %>%  \n  filter(type == \"Entity.Vessel.CargoVessel\") %>% \n  arrange(desc(tonnage))\ncargo_vessels\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 100 × 20\n   type        `_last_edited_by` `_date_added` `_last_edited_date` `_raw_source`\n   <chr>       <chr>             <date>        <date>              <chr>        \n 1 Entity.Ves… Melinda Manning   2035-02-01    2035-02-17          Oceanus Vess…\n 2 Entity.Ves… Harvey Janus      2034-12-02    2034-12-22          Oceanus Vess…\n 3 Entity.Ves… Olokun Daramola   2035-02-13    2035-03-02          Oceanus Vess…\n 4 Entity.Ves… Harvey Janus      2034-12-03    2034-12-15          Oceanus Vess…\n 5 Entity.Ves… Harvey Janus      2035-02-20    2035-03-03          Oceanus Vess…\n 6 Entity.Ves… Harvey Janus      2035-01-06    2035-01-21          Oceanus Vess…\n 7 Entity.Ves… Jack Inch         2035-02-01    2035-02-20          Oceanus Vess…\n 8 Entity.Ves… Jack Inch         2034-11-08    2034-11-21          Oceanus Vess…\n 9 Entity.Ves… Jack Inch         2034-12-12    2034-12-28          Oceanus Vess…\n10 Entity.Ves… Jack Inch         2034-12-31    2035-01-12          Oceanus Vess…\n# ℹ 90 more rows\n# ℹ 15 more variables: `_algorithm` <chr>, name <chr>, id <chr>, Name <chr>,\n#   Description <chr>, Activities <list>, kind <chr>, qty_tons <dbl>,\n#   date <date>, flag_country <chr>, company <chr>, tonnage <int>,\n#   length_overall <int>, style <chr>, fish_species_present <list>\n```\n\n\n:::\n:::\n\n\nThere are 100 cargo vessels, with tonnage ranging from 2,100 to 76,300.\n\n## 2.3 The flow of cargo\n\nFinding out which commodity goes to which ports.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncargo_port_list <- mc2_edges_raw %>% \n  filter(type == \"Event.Transaction\") %>% \n  select(source,target) %>% \n  filter(target %in% c(\"City of Haacklee\",\n                       \"City of Lomark\",\n                       \"City of Himark\",\n                       \"City of Paackland\",\n                       \"City of South Paackland\",\n                       \"City of Port Grove\"))\n\ncargo_commodity_list <- mc2_edges_raw %>% \n  filter(type == \"Event.Transaction\") %>% \n  select(source,target) %>% \n  filter(!target %in% c(\"City of Haacklee\",\n                       \"City of Lomark\",\n                       \"City of Himark\",\n                       \"City of Paackland\",\n                       \"City of South Paackland\",\n                       \"City of Port Grove\")) %>% \n  rename(commodity = target)\n\ncargo_list <- cargo_port_list %>% \n  left_join(cargo_commodity_list) %>%\n  left_join(transaction_edges) %>% \n  select(source, target, commodity, date) %>% \n  rename(cargo = source, city = target)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndelivery_nodes <- mc2_nodes_raw %>% \n  filter(type == \"Entity.Document.DeliveryReport\")\n```\n:::\n\n\n\n\nAdding quantity (qty_ton) to cargos\n\n::: {.cell}\n\n```{.r .cell-code}\ncargo_list <- delivery_nodes %>% \n  select(id,qty_tons) %>% \n  rename(cargo = id) %>% \n  left_join(cargo_list)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlocation <- mc2_nodes_raw %>% \n  filter(kind %in% c(\"Fishing Ground\", \"Ecological Preserve\")) %>% \n  select(id, kind, fish_species_present)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntransponder_ping_edge <- mc2_edges_raw %>% \n  filter(type == \"Event.TransportEvent.TransponderPing\")\n```\n:::\n\n\nFinding the vessel that enters the city same day as the cargo\n\n::: {.cell}\n\n```{.r .cell-code}\nfishing_vessel_list <- fishing_vessels_nodes %>% \n  select(id) \n\nfishing_vessel_list <- as.list(fishing_vessel_list)\n\nvessel_city_list <- transponder_ping_edge %>% \n  filter(target %in% unlist(fishing_vessel_list)) %>% \n  filter(source %in% c(\"City of Haacklee\",\n                       \"City of Lomark\",\n                       \"City of Himark\",\n                       \"City of Paackland\",\n                       \"City of South Paackland\",\n                       \"City of Port Grove\")) %>% \n  filter(dwell > 0) %>% \n  mutate(time = substr(time,1,10)) %>% \n  mutate(time = ymd(`_date_added`)) %>% \n  select(source, target, time) %>% \n  distinct() %>% \n  rename(date = time, target = source, id = target)\n```\n:::\n\n\n\n\n\n## 3.0 Task 2\n\nDevelop visualizations that illustrate the inappropriate behavior of SouthSeafood Express Corp vessels. How do their movement and catch contents compare to other fishing vessels? When and where did SouthSeafood Express Corp vessels perform their illegal fishing? How many different types of suspicious behaviors are observed? Use visual evidence to justify your conclusions.\n\n\n## 3.1 Illegal fishing by SouthSeafood Express Corp\n\nSouthSeafood Express Corp operates two fishing vessels by the id of \"snappersnatcher7be\" and \"roachrobberdb6\".\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntransponder_ping_edge_agg <-\n  transponder_ping_edge %>%\n  distinct() %>%\n  group_by(source, target, type) %>%\n  summarise(weights = n()) %>%\n  filter(source!=target) %>% \n  ungroup\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntransponder_ping_edge_agg %>% \n  filter(target %in% c(\"snappersnatcher7be\",\"roachrobberdb6\")) %>%\n  group_by(target) %>% \n  ggplot(aes(x=target, y=source,\n             size = weights)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsouthseafood_edge <- mc2_edges_raw %>% \n  filter(type == \"Event.TransportEvent.TransponderPing\") %>% \n  filter(target %in% c(\"snappersnatcher7be\",\"roachrobberdb6\")) %>% \n  arrange(target,time)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nssf_edges_agg <-\n  southseafood_edge %>%\n  distinct() %>%\n  group_by(source, target, type) %>%\n  summarise(weights = n()) %>%\n  filter(source!=target) %>% \n  ungroup\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nid1 <- ssf_edges_agg %>% \n  select(source) %>% \n  rename(id = source) \n\nid2 <- ssf_edges_agg %>% \n  select(target) %>% \n  rename(id = target)\n\nmc2_nodes1 <- rbind(id1,id2) %>% \n  distinct() \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nssf_graph <- tbl_graph(nodes = mc2_nodes1,\n                       edges = ssf_edges_agg,\n                       directed = TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add a color column to nodes\nssf_graph <- ssf_graph %>%\n  activate(nodes) %>%\n  mutate(color = case_when(\n    id %in% c(\"snappersnatcher7be\", \"roachrobberdb6\") ~ \"blue\",\n    TRUE ~ \"\"\n  ))\n\n# Create the plot\nssf_graph %>% \n  activate(edges) %>%\n  arrange(desc(weights)) %>% \n  ggraph(layout = \"fr\") +\n  geom_edge_link(aes(color = \"\", \n                     linewidth = weights)) +\n  geom_node_point(aes(color = color, size = 10)) + \n  theme_graph() +\n  theme(\n    plot.background = element_rect(fill = \"white\", color = NA),\n    text = element_text(color = \"black\"))+\n  geom_node_text(aes(label = id), \n                 repel = TRUE, \n                 vjust = 1, \n                 hjust = 1,\n                 size = 3)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\n\n\n## 4.0 Task 4\n\n**The Questions**:\n\n1.  How did fishing activity change after SouthSeafood Express Corp was caught? \n\n2.  What new behaviors in the Oceanus commercial fishing community are most suspicious and why?\n\nIn order to understand the change in fishing activities, we first have to determine the date where SouthSeafood Express Corp was caught. We will use this timeline as the \n\nThe final activities of SouthSeafood's vessels are on 2035-05-16 (snappersnatcher7be) and  2035-05-16 (roachrobberdb6) according to the transponder pings. Hence, we can conclude that the SouthSeafood is caught for illegal fishing, and had ceased operating its fishing vessels since 2035-05-16. \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "supporting": [
      "Take-home_Ex03_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}